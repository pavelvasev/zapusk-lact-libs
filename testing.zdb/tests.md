# Устройство файла тестов

Файл тестов содержит набор тестов. Среди них есть:
* Обычные - см далее Виды тестов.
* Особенные - вход и выход из контекста, см. далее Смена контекста.

Каждый тест имеет параметры:
* **code** - вид (код) теста
* **comment** - человеко-читаемое пояснение
* **guid** - уникальный идентификатор теста
* **набор доп. параметров** - соответствующие виду теста дополнительные параметры.

# Виды тестов

Вид теста указывается в поле `code`.
Далее идет перечисление видов тестов и соответствующие им параметры.

## Файловые

Во многих файловых тестах указывается список имен файлов или каталогов.
Элементы списка разделяются пробелом, а в случае пробела в имени
файла их следует экранировать символом `\`.

### file-exist
Проверяет что все файлы из набора существуют.

* **list** - набор путей к файлам.

### dir-exist
Проверяет что все каталоги из набора существуют.

* **list** - набор путей к каталогам, через пробел.

### fs-mode
Проверяет права доступа к указанным файлам/каталогам.
* **list** - набор путей.
* **mode** - права (в десятичной или символьной нотации)

### fs-user
Проверяет что указанные файлы/каталоги принадлежат пользователю
* **list** - набор путей
* **user** - имя пользователя

### dir-not-empty
Проверяет, что в каталоге есть файлы или подкаталоги.
* **path** - путь к каталогу.

### dir-mounted
Проверяет, что указанный каталог - примонтирован.
* **path** - путь к каталогу.

### file-has-lines
Проверяет, что файл содержит указанные строки.
* **path** - путь к файлу
* **content** - одна или более строк, которые должны находиться где-либо в файле. 
Строки должны идти одна за другой.

Строки следует сравнивать с начала строки. При этом если в файле в конце строк 
есть комментарий вида `# тест`, то его при сравнении следует игнорировать.

## Процессы

### process-exist
Проверяет, что процессы существуют.

* **name** - регулярное выражение для имени процесса.
* **pidfile** - файл с pid процесса.
* **count** - минимальное число процессов, которые должны иметь указанное имя. Значение по умолчанию 1.
* **max** - максимальное число процессов, которые должны иметь указанное имя. Значение по умолчанию inf.

Для идентификации процесса используется либо name либо pidfile.

### process-memory-max
Проверяет, что процесс занимает не более чем указанное кол-во памяти.

* **name**, **pidfile** - аналогично process-exist.
* **mb** - кол-во мегабайт.

## Сети



## ОС

### package-installed
Проверяет, что в системе установлены указанные пакеты.
* **list** - перечень пакетов, разделенных пробелом.

### service-working
Проверяет, что сервис с указанным именем - работает.
* **name** - имя сервиса.

## Прочее

### git-cloned
Проверяет что в указанный каталог склонирован указанный репозиторий.
* **repo** - адрес репозитория
* **dir** - каталог

### sshd-no-password-auth
Проверяет, что к ssh не принимает вход по паролю.
* **ip_port** - порт ssh.
* **network_locations** - список классов мест "откуда", разделенных через пробел.
Значение по умолчанию: `*`, т.е. все известные классы.
Известные классы: localhost, network, internet.


# Смена контекста

Есть особые виды теста которые задают смену контекста:

### context-begin-machine
Следующие за этим тесты относятся к заданной машине.
* **host** - домен или ip-адрес машины

### context-finish-machine
Сообщает, что закончились тесты относящиеся к указанной ранее машине.

### context-begin-chroota
Следующие за этим тесты относятся к заданной чруте (на текущей машине)
* **path** - каталог чруты.

### context-finish-chroota
Сообшщает, что закончились тесты относящиеся к указанной чруте.
