####### params
content=
path=/etc/nginx/sites-enabled/{{global_name}}

####### check-conf-is-valid
[info]
apply=Checking current nginx config
[os]
apply=nginx -t || (rm -f {{path}}; echo "NGINX CONFIG IS ALREADY BROKEN! repair it!"; exit 200)

####### write-conf
[commands]
apply

[info]
apply=Writing and checking nginx config item: {{path}}
destroy=Removing nginx config item: {{path}}

[file]
path={{path}}
content={{content}}

####### check-written-conf
[os]
apply=nginx -t || (cat {{path}}; rm -f {{path}}; echo "THIS CONFIG WILL BREAK NGINX! broken file is now removed, execution is stopped."; exit 200)

################## schedule-reload
#[defer]
#key=nginx-reload
[os]
apply=echo nginx-reload=/etc/init.d/nginx reload >>$ZAPUSK_DEFERRED_PATH
#destroy=/etc/init.d/nginx reload
destroy=echo nginx-reload=/etc/init.d/nginx reload >>$ZAPUSK_DEFERRED_PATH
